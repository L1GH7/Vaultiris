# CVE-2021-41773

## 1. 환경 구성
+ **Ubuntu 20.04 버전**

+ **Apache 2.4.49~50 버전**
  - apr 1.7.0 설치
  - apr util 1.6.1 설치

- **라이브러리 설치**
  - pcre3 - apt-get install libpcre3-dev
  - ssl - apt-get install libssl-dev
  - expat1 - apt-get install libexpat1-dev

- **apache 소스 컴파일** 

  - ./configure --prefix=/usr/local/apache --enable-so --enable-rewrite --enable-ssl --enable-mods-shared=all --enable-modules=shared --enable-mpms-shared=all --with-included-apr --enable-unique-id

  - make -j 8 ; make install

- **httpd 스크립트 복사 및 서비스 등재**

  - cp -a /usr/local/apache/bin/apachectl /etc/init.d/httpd
  - ln -s /etc/init.d/httpd /etc/rc3.d/S99httpd

- **Apache 시작**

  - /etc/init.d/httpd start

   ![2](https://user-images.githubusercontent.com/89399749/138073552-8abba2b3-2f72-4703-b724-a2a1ea386b0c.png)





## 1-1. 정보 수집

1. apache default 오류페이지 확인 후 Directory Traversal 취약점 확인하였으나 실패

   ![4](https://user-images.githubusercontent.com/89399749/138073577-cf701bc4-7f28-4cf5-9b8e-687104bad89c.png)




2. nmap을 통해 아파치 서버 정보(2.4.49) 확인

   ![5](https://user-images.githubusercontent.com/89399749/138073589-327ad07c-d470-4530-a104-4dfd1ddc8c4e.png)





## 2. PoC

1. curl을 통해 사용자 계정 정보가 노출되는것을 확인

   ![6](https://user-images.githubusercontent.com/89399749/138073631-4b1df0d0-1414-4016-b849-94bba33d43aa.png)


   

2. curl을 통해 사용자 그룹 관리 정보가 노출되는것을 확인

   ![7](https://user-images.githubusercontent.com/89399749/138073659-c8fee264-ea1a-4a5c-927c-c0fcad8cfbc3.png)





## 3. 원인 분석

1. httpd.conf 설정 파일 중 Directory/ 부분이 denied가 아닌 granted(허용)되어 취약점 발생

   ![1](https://user-images.githubusercontent.com/89399749/138073677-1f1199da-471e-450e-a6b2-af1050f25f1f.png)




 2. URL 매핑 부분에서 취약점이 발생됨을 이용하여 directory traversal attack이 가능한것을 확인

    ![소스코드](https://user-images.githubusercontent.com/89399749/138073706-eb5e1e04-f5e7-4d6d-bdb2-f99f0c45d007.png)

	
	

## 4. 대응 방안

1. httpd.conf 설정 파일 중 Directory/ 부분을 denied로 변경

   ![12312312](https://user-images.githubusercontent.com/89399749/138075196-e75faa4b-2989-4653-9349-ba6d30933757.png)

2. Apache 서버 정보(2.4.49~50)가 노출되지 않게 수정

3. Apache default 오류페이지가 노출되지 않게 수정



## 5. 참조

https://httpd.apache.org/security/vulnerabilities_24.html

https://github.com/lorddemon/CVE-2021-41773-PoC/

https://github.com/iilegacyyii/PoC-CVE-2021-41773

https://library.gabia.com/contents/infrahosting/3513/





