From 0670a05fdab997036a3fc3ef113b8f5922e574da Mon Sep 17 00:00:00 2001
From: Michiel Rook <michiel@michielrook.nl>
Date: Thu, 19 Nov 2020 09:52:43 +0100
Subject: [PATCH] Fixes #33 - ensure we catch additional malicious/crafted
 filenames

---
 Archive/Tar.php | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/Archive/Tar.php b/Archive/Tar.php
index 5a52ce8..9271074 100644
--- a/Archive/Tar.php
+++ b/Archive/Tar.php
@@ -1730,7 +1730,7 @@ public function _readHeader($v_binary_data, &$v_header)
 
         // ----- Extract the properties
         $v_header['filename'] = rtrim($v_data['filename'], "\0");
-        if ($this->_maliciousFilename($v_header['filename'])) {
+        if ($this->_isMaliciousFilename($v_header['filename'])) {
             $this->_error(
                 'Malicious .tar detected, file "' . $v_header['filename'] .
                 '" will not install in desired directory tree'
@@ -1800,9 +1800,9 @@ private function _tarRecToSize($tar_size)
      *
      * @return bool
      */
-    private function _maliciousFilename($file)
+    private function _isMaliciousFilename($file)
     {
-        if (strpos($file, 'phar://') === 0) {
+        if (strpos($file, '://') !== false) {
             return true;
         }
         if (strpos($file, '../') !== false || strpos($file, '..\\') !== false) {
@@ -1838,7 +1838,7 @@ public function _readLongHeader(&$v_header)
 
         $v_filename = rtrim(substr($v_filename, 0, $v_filesize), "\0");
         $v_header['filename'] = $v_filename;
-        if ($this->_maliciousFilename($v_filename)) {
+        if ($this->_isMaliciousFilename($v_filename)) {
             $this->_error(
                 'Malicious .tar detected, file "' . $v_filename .
                 '" will not install in desired directory tree'
